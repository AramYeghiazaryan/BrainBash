<!DOCTYPE html>

<style>
    .txtAnswer {
        position: relative;
        overflow: hidden;
        left: 0;
    }

    .txtAnswer label {
        position: absolute;
        left: 5px;
    }

</style>

<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
        <meta charset="UTF-8">
    <title>Add a Question</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <script
            src="https://code.jquery.com/jquery-3.3.1.js"
            integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
            crossorigin="anonymous"></script>
</head>
<body>

    <label>
        Topic : <select name="topic" id="topic">
        <option th:each="topic : ${topics}"
                th:value="${topic.getId()}"
                th:text="${topic.topicName}">
        </option>
    </select>
    </label>
    <br/>
    <label>
        Question body <input name="questionText" id="questionText" type="text">
    </label>
    <br/>
    <label>
        Level : <select name="level" id="level">
        <option name="beginner">beginner</option>
        <option name="intermediate">intermediate</option>
        <option name="advanced">advanced</option>
    </select>
    </label>
    <br/>
    <label>
        Points <input name="points" type="text" id="points">
    </label>
    <br/>
    <label>
        Correct answer count <input name="correct_answer_count" type="text" id="correct_answer_count">
    </label>
    <br/>

    <div id="answerBlock">
        <button type="button" id="btnAddAnswer" class="txtAnswer" onclick="addAnswer()">Add answer</button>
        <button type="button" id="btnRemoveAnswer" class="txtAnswer" onclick="removeAnswer()">Remove answer</button>
    </div>

    <input type="button" value="button" onclick="createQuestion()">

    <br/>
</body>

<script>
    let answerCount = 0;

    function addAnswer() {

        answerCount++;

        let $answerBlock = $('#answerBlock');
        let $answerSet = $('<div/>').attr('class','answerClass');
        let answerText = $('<input/>').attr('type','text').attr('id','answerText');
        let answerDescription = $('<input/>').attr('type','text').attr('id','answerDescription');
        let isCorrect = $('<input/>').attr('type','checkbox').attr('id','isCorrect');
        let label = $('<label/>').html('Answer #' + answerCount + ': ');
        let descriptionLabel = $('<label/>').html(' Description: ');
        let isCorrectLabel = $('<label/>').html(' Is Correct ');

        $answerBlock.append($answerSet);
        $answerSet.append(answerText).append(descriptionLabel).append(answerDescription).append(isCorrect).append(label);
        $answerSet.prepend(label);
        $answerSet.append(isCorrectLabel);


    }
    function removeAnswer() {
        if (answerCount >= 1) {
            let divToRemove = $('.answerClass').last();
            divToRemove.remove();
            answerCount--;
        }
    }
    
    
    function createQuestion() {
        let topicId = parseInt($('#topic').val());
        let questionText = $('#questionText').val();
        let level = $('#level').val();
        let points  = parseInt($('#points').val());
        let correctAmount = parseInt($('#correct_answer_count').val());




        let answerData = $('#answerBlock').find('.answerClass').map(function () {

            let answerText = $(this).find('#answerText').val();
            let answerDescription = $(this).find('#answerDescription').val();
            let isCorrect = $(this).find('#isCorrect').is(":checked");

            return {
                answer : answerText,
                description : answerDescription,
                correct : isCorrect
            }
        }).toArray();
        console.log(answerData);

        let question = JSON.stringify({
            topicId : topicId,
            question : questionText,
            correct_amount : correctAmount,
            level : level,
            points : points,
            answerDtoList : answerData
        });
        console.log(question);

        $.ajax({
            type : "POST",
            data : question,
            url : "/question/add",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success : (function () {
                alert('Question was successfully created');
            })
        });
    }
</script>

</html>